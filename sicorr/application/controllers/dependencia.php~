<?php
	
	class Dependencia_controller extends Controller {
		
		var $wrapper;

		public function __construct( )
		{
			parent::__construct( );
			$this->session = Session::instance( );
			$this->wrapper = new View('wrapper');
		}

		/*----------------------------------*/

		
		public function index( )
		{
			$content = new View('dependencia/index');
			$dependencias = ORM::factory('dependencia')->find_all( )->as_array( );
			$content->dependencias = $dependencias;
			$this->wrapper->content = $content;
			$this->wrapper->render(TRUE);
		}
		
		public function nuevo( )
		{
			$content = new View('dependencia/form');
			$this->wrapper->prototype = 1;
			$this->wrapper->js = array('dependencia');
			$this->wrapper->content = $content;
			$this->wrapper->render(TRUE);
			
		}		
        public function guardar($id=FALSE)
		{
			extract($_POST);
			
			/* si el id es falso significa que es un registro nuevo */
			if ($id==FALSE) $depen = ORM::factory('dependencia',FALSE);
			/* de lo contrario se va actualizar un registro */
			else $depen = ORM::factory('dependencia')->find($id);
			$depen->direccion = $direccion;
			$depen->cedula    = $cedula;
			$depen->nombre    = $nombre;
			$depen->apellido  = $apellido;
			$depen->telefono	= $telefono;        	
			$depen->save( );
			//------------------------------------------
			$this->session->set_flash('msj','Registro Guardado');
			url::redirect('dependencia');
		}
	
	   public function editar($id)
		{
			$content = new View('dependencia/form');
			$depen = ORM::factory('dependencia')->find($id);
			$content->id 			= $depen->id;
			$content->direccion  = $depen->direccion;
			$content->cedula		= $depen->cedula;
			$content->nombre     = $depen->nombre;
			$content->apellido   = $depen->apellido;
			$content->telefono   = $depen->telefono;
			$this->wrapper->content = $content;
			$this->wrapper->prototype = 1;
			$this->wrapper->js = array('dependencia');
			$this->wrapper->render(TRUE);
		}
	
		// REST
	
		public function eliminar($id)
		{
			$depen = ORM::factory('dependencia')->find($id);
			$depen->delete( );
			//-------------------------------------------
			$this->session->set_flash('msj','Registro Eliminado');
		   url::redirect('dependencia');
      }
         
 }

// End Login
